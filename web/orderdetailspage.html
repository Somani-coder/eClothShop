<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title> Explore Now-2 Attire </title>
        <link href="style.css" rel="stylesheet" type="text/css" />
        <link href="https://fonts,googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>


    <body>
        <div class="container">
            <div class="navbar">
                <div class="logo">
                    <img src="https://i.pinimg.com/564x/fd/83/c5/fd83c5d3c62594a851ecd31abf1109b9.jpg" width="125px">
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="login.html">Account</a></li>
                    </ul>
                </nav>
                <li><a href="cart.html"><img src="https://i.pinimg.com/564x/9e/b3/1f/9eb31f1397aa013972c607f8d38923fd.jpg" width="30px" height="30px"></a></li>
                <li><a href="ordersection.html"><img
                            src="https://w7.pngwing.com/pngs/813/633/png-transparent-burger-line-list-menu-nav-navigation-option-mobile-basic-icon-thumbnail.png"
                            class="menu-icon"></a></li>
            </div>
        </div>

        <div class="order-details"> 
            
            <p id ="orderDt"></p>
            <p><b>Status:</b> In Cart</p>

            <h2>1.Select your Delivery Address Options</h2>
            <div class="delivery-locations">
                <label>
                    <label for="street">Address Line 1:</label>
                    <input type="text" id="street1" name="street" placeholder="Enter Address Line 1">
                    <br><br>
                    <label for="city">Address Line 2:</label>
                    <input type="text" id="city1" name="city" placeholder="Enter Address Line 2">
                    <br><br>
                    <label for="postalCode">Address Line 3:</label>
                    <input type="text" id="postalCode1" name="postalCode" placeholder="Enter Address Line 3">
                </label>
                <br><br>
            </div>

            <h2>Payment Options</h2>
            <div class="payment-options">
                <label>
                    <input type="radio" id="cashPayment" name="payment" value="Cash On Delivery">
                    Cash on Delivery
                </label>
            </div>


            <button  onclick="placeOrder(document.getElementById('street1').value, document.getElementById('city1').value, document.getElementById('postalCode1').value, document.getElementById('cashPayment').value)">Order Confirmation</button>



            <div class="success-message" id="success">
                <span class="success-icon"></span>Your order is shipped successfully
            </div>
        </div>


        <!------------ Footer ------------->
        <div class="footer">
            <div class="Brands">
                <div class="container">
                    <div class="row">
                        <div class="footer-col-1">
                            <h3>Download Our App</h3>
                            <p>Download App For Android And ios Mobile Phone.</p>
                        </div>
                        <div class="footer-col-2">
                            <img src="https://i.pinimg.com/564x/fd/83/c5/fd83c5d3c62594a851ecd31abf1109b9.jpg">
                            <p>Our Purpose Is To Sustainably Make The Pleasure And Benifits Of Buying and renting The Products To the
                                many.</p>
                        </div>
                        <div class="footer-col-3">
                            <h3>Useful Links</h3>
                            <ul>
                                <li>Coupons</li>
                                <li>Blog Post</li>
                                <li>Return Policy</li>
                                <li>Join Affiliate</li>
                            </ul>
                        </div>
                        <div class="footer-col-4">
                            <h3>Follow Us</h3>
                            <ul>
                                <li>Facebook</li>
                                <li>Twitter</li>
                                <li>Instagram</li>
                                <li>YouTube</li>
                            </ul>
                        </div>
                    </div>
                    <hr>

                </div>

            </div>
        </div>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>

        <script type="text/javascript">
                window.onload = loadDate();
                function loadDate() {
                    
                    document.getElementById("orderDt").innerHTML ='Order Date: ' +
                            formatAMPM();
                }
                function formatAMPM() {
                    var d = new Date(),
                            minutes = d.getMinutes().toString().length == 1 ? '0' + d.getMinutes() : d.getMinutes(),
                            hours = d.getHours().toString().length == 1 ? '0' + d.getHours() : d.getHours(),
                            ampm = d.getHours() >= 12 ? 'pm' : 'am',
                            months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                            days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    return days[d.getDay()] + ' ' + months[d.getMonth()] + ' ' + d.getDate() + ' ' + d.getFullYear() + ' ' + hours + ':' + minutes + ampm;
                }

                var address1;
                var address2;
                var address3;
                var paymentMethod;
                function placeOrder(add1, add2, add3, payment)
                {
                    address1 = add1;
                    address2 = add2;
                    address3 = add3;
                    paymentMethod = payment;

                    getCartDetail();
                }
                function getCartDetail()
                {
                    var userData = new Object();
                    userData.uName = "somani@gmail.com";

                    userData.command = "FetchCart";

                    $.ajax({
                        type: "POST",
                        url: "http://localhost:8080/eClothShop/CartItems",
                        data: JSON.stringify(userData),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                            confirmOrder(response);
                            //                                   $.each(response, function () {

                            //                                        $.each(this, function (key, value) {
                            //                                            alert(key);
                            //                                            alert(value);
                            //                                        });
                            //                                   });

                        },
                        failure: function (response) {
                            alert(response.message);

                        }
                    });

                }
                function OnSuccess(response) {

                    alert(response.message());
                    // buildTable(response);
                }

                function confirmOrder(response)
                {

                    var productData = '{"command":"add_order","products":[]}';
                    var obj = JSON.parse(productData);

                    var rowindex = 0;
                    for (var i = 0; i < response.length; i++) {
                        var source = response[rowindex].source;
                        var productName = response[rowindex].description;
                        var price = response[rowindex].price;
                        var quantity = response[rowindex].quantity;
                        var address = address1 + address2 + address3;


                        obj['products'].push({"orderId": 111, "productName": productName, "price": price, "quantity": quantity, "address": address, "paymentMethod": paymentMethod, "source": source});


                    }


                    //localStorage.setItem("cartData", JSON.stringify(obj));


                    //calling backend to store order details
                    $.ajax({
                        type: "POST",
                        url: "http://localhost:8080/eClothShop/placeorder",
                        data: JSON.stringify(obj),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                            alert(response.message);
                            if (response.message === 'Added to order successfully..')
                            {

                                // window.location.href = "index.html";
                            } else
                            {
                                //window.location.href = "regmodal.html";
                            }
                        },
                        failure: function (response) {
                            alert(response.message);
                            //  location.href = "regmodal.html";
                        }
                    });

                }
//                         function OnSuccess(response) {
//
//                                    alert(response.message());
//                                }

        </script>
    </body>

</html>